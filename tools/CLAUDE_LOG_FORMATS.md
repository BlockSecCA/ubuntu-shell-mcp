# Claude Log Formats Reference

This document describes all log file formats generated by Claude Desktop and how our tools handle them.

## Log File Locations

All Claude logs are stored in: `%APPDATA%\Claude\logs\`

## Log Formats

### Format 1: MCP Server Logs (Individual Servers)
**Files**: `mcp-server-*.log` (e.g., `mcp-server-ubuntu-shell-mcp.log`)

**Format**: `TIMESTAMP [server-name] [level] Message { metadata: ... }`

**Example**:
```
2025-11-12T16:19:01.312Z [ubuntu-shell-mcp] [info] Initializing server... { metadata: undefined }
2025-11-12T16:19:01.422Z [ubuntu-shell-mcp] [info] Message from client: {"method":"initialize",...} { metadata: undefined }
```

**Timestamp Format**: ISO 8601 with milliseconds and Z suffix (`YYYY-MM-DDTHH:mm:ss.sssZ`)

**Contains**:
- MCP protocol messages (initialize, tools/list, tools/call)
- Server lifecycle events
- Command execution details
- JSON-RPC messages

### Format 2: MCP Unified Log
**Files**: `mcp.log`

**Format**: `TIMESTAMP [level] [server-name] Message`

**Example**:
```
2025-11-12T16:19:01.310Z [info] [Filesystem] Initializing server...
2025-11-12T16:19:01.311Z [info] [obsidian-vault-images-mcp-v2] Initializing server...
2025-11-12T16:19:01.420Z [info] [Filesystem] Message from client: {"method":"initialize",...}
```

**Timestamp Format**: ISO 8601 with milliseconds and Z suffix (`YYYY-MM-DDTHH:mm:ss.sssZ`)

**Contains**:
- All MCP server events from all servers
- Unified view of MCP activity
- Same message types as individual server logs

### Format 3: Claude Desktop Main Log
**Files**: `main.log`

**Format**: `TIMESTAMP [level] Message`

**Example**:
```
2025-11-12 11:18:58 [info] Starting app { appVersion: '1.0.332', ... }
2025-11-12 11:18:58 [info] Update URL: https://downloads.claude.ai/releases/win32/x64
2025-11-12 11:18:59 [info] Checking 3 extensions via can_install API
```

**Timestamp Format**: Simple format with space separator (`YYYY-MM-DD HH:mm:ss`)

**Contains**:
- App lifecycle (start/stop)
- Version information
- Extension management (installation, updates)
- Update checks
- High-level MCP activity (as stderr output)

### Format 4: Web/Window Logs
**Files**: `claude.ai-web.log`, `unknown-window.log`

**Format**: `TIMESTAMP [level] Message`

**Example**:
```
2025-11-12 11:18:59 [warn] Error with Permissions-Policy header: Unrecognized feature: 'web-share'.
2025-11-12 11:18:59 [error] Refused to apply inline style because it violates CSP directive...
```

**Timestamp Format**: Simple format with space separator (`YYYY-MM-DD HH:mm:ss`)

**Contains**:
- Browser/renderer warnings and errors
- CSP violations
- Web content issues

## Tool Compatibility Matrix

| Tool | Format 1 (MCP Servers) | Format 2 (mcp.log) | Format 3 (main.log) | Format 4 (Web logs) |
|------|----------------------|-------------------|--------------------|--------------------|
| **Universal Log Viewer** | ✅ Full support | ✅ Full support | ✅ Full support | ✅ Full support |
| **Archive Script (v2)** | ✅ Archives by date | ✅ Archives by date | ✅ Archives by date | ✅ Archives by date |
| **Archive Script (v1)** | ❌ Skips (no date match) | ❌ Skips (no date match) | ✅ Archives by date | ✅ Archives by date |

## Tools Documentation

### Universal Log Viewer (`mcp-log-viewer-universal.html`)

**Capabilities**:
- Parses all 4 log formats
- Extracts and displays MCP protocol messages (JSON-RPC)
- Filters by message type (client/server/commands/lifecycle)
- Time range filtering
- Server name filtering
- Statistics and visualization

**Usage**:
1. Open HTML file in browser
2. Drag and drop any `.log` file
3. Use filters to explore the data

### Archive Script v2 (`archive-mcp-logs.ps1`)

**Capabilities**:
- Handles both ISO timestamps and simple timestamps
- Groups log entries by date
- Creates dated archive files: `{basename}-YYYY-MM-DD.log`
- Maintains state to avoid re-processing
- Works incrementally (only archives new entries)

**Usage**:
```powershell
.\archive-mcp-logs.ps1
```

**Output**:
```
archive/
  ├── mcp-server-ubuntu-shell-mcp-2025-11-12.log
  ├── mcp-2025-11-12.log
  ├── main-2025-11-12.log
  └── claude.ai-web-2025-11-12.log
```

## Timestamp Parsing Rules

The updated parser tries formats in this order:

1. **ISO with 'T' separator**: `^(\d{4}-\d{2}-\d{2})T` → Extracts date portion
2. **Simple with space**: `^(\d{4}-\d{2}-\d{2})\s` → Extracts date portion

Both extract the `YYYY-MM-DD` date for archiving purposes.

## Common Issues

### Issue: Old archives missing MCP server logs
**Cause**: Old archive script only matched simple timestamp format  
**Solution**: Run updated `archive-mcp-logs.ps1` to catch up

### Issue: Viewer shows "Failed to parse line"
**Cause**: Log line doesn't match any known format  
**Solution**: Check console for the failed line and update parser if it's a new format

### Issue: Log files growing too large
**Cause**: Logs accumulate over time  
**Solution**: Run archive script regularly (recommended: daily via Task Scheduler)

## Future Considerations

- Add support for multiline log entries (stack traces)
- Add compression for archived logs
- Add automatic cleanup of old archives
- Consider log rotation at the source (if Claude Desktop adds support)

